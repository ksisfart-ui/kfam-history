<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æš¦ã¡ã²ã‚DMå±¥æ­´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8f9fa; font-family: -apple-system, "Helvetica Neue", Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        .app-container { max-width: 600px; margin: 0 auto; min-height: 100vh; background-color: white; display: flex; flex-direction: column; }
        .header { background-color: #335c7d; color: white; padding: 14px 16px; font-weight: bold; font-size: 1.1rem; flex-shrink: 0; }
        .hidden { display: none !important; }

        /* ãƒªã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; border-bottom: 1px solid #f0f0f0; transition: background 0.2s;
        }
        .list-item:active { background-color: #f0f4f8; }

        /* ãƒãƒ£ãƒƒãƒˆãƒãƒ–ãƒ« */
        .bubble {
            background-color: #f1f3f5; border-radius: 18px; padding: 12px 16px;
            display: inline-block; max-width: 85%; line-height: 1.5; color: #333;
        }

        .user-icon { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background-color: #e9ecef; flex-shrink: 0; }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒªãƒ³ã‚¯ */
        .footer-link { margin-top: auto; padding: 40px 16px 24px; text-align: center; }
        .footer-link a { color: #999; font-size: 12px; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">æš¦ã¡ã²ã‚DMå±¥æ­´</div>

    <div id="home-screen" class="content-view">
        <div class="p-4 font-bold text-gray-500 text-sm bg-gray-50 border-b">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
        <div id="group-list">
            </div>
    </div>

    <div id="chat-screen" class="content-view hidden">
        <div class="p-2 border-b flex items-center bg-white sticky top-0 z-20">
            <button onclick="showHome()" class="flex items-center text-[#007AFF] px-2 py-1">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                <span class="text-[17px] ml-1">æˆ»ã‚‹</span>
            </button>
            <span id="chat-title" class="ml-4 font-bold text-gray-800 text-[17px]"></span>
        </div>
        <div id="chat-content" class="p-4 space-y-6"></div>
    </div>

    <div id="about-screen" class="content-view hidden">
        <div class="p-2 border-b flex items-center bg-white sticky top-0 z-20">
            <button onclick="goBack()" class="flex items-center text-[#007AFF] px-2 py-1">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                <span class="text-[17px] ml-1">æˆ»ã‚‹</span>
            </button>
        </div>
        <div class="p-6">
            <div class="border-l-4 border-[#335c7d] pl-3 mb-6">
                <h3 class="font-bold text-gray-800 text-lg">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</h3>
            </div>
            <ul class="text-[14px] leading-relaxed space-y-4 text-gray-600">
                <li class="relative pl-4 before:content-['â€¢'] before:absolute before:left-0 before:text-[#335c7d]">
                    æœ¬ã‚µã‚¤ãƒˆã¯ã€Œã‚¹ãƒˆã‚°ãƒ©ã€ãŠã‚ˆã³ã€Œæš¦å®¶ã€ã‚’å¿œæ´ã™ã‚‹éå…¬å¼ã®ãƒ•ã‚¡ãƒ³ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
                </li>
                <li class="relative pl-4 before:content-['â€¢'] before:absolute before:left-0 before:text-[#335c7d]">
                    é‹å–¶å…ƒãŠã‚ˆã³é–¢ä¿‚è€…æ§˜ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã”ã–ã„ã¾ã›ã‚“ã€‚
                </li>
                <li class="relative pl-4 before:content-['â€¢'] before:absolute before:left-0 before:text-[#335c7d]">
                    æ²è¼‰å†…å®¹ã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€é€Ÿã‚„ã‹ã«å‰Šé™¤ç­‰ã®å¯¾å¿œã‚’ã„ãŸã—ã¾ã™ã€‚
                </li>
                <li class="relative pl-4 before:content-['â€¢'] before:absolute before:left-0 before:text-[#335c7d]">
                    åˆ¶ä½œè€…ï¼šã‚¢ãƒ‰ğŸ‰<a href="https://x.com/admiral_splus" target="_blank" class="text-blue-500 underline">@admiral_splus</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="footer-link" id="common-footer">
        <a onclick="showAbout()">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
    </div>
</div>

<script>
    let allChatData = {};
    let previousView = 'home-screen';

    async function loadData() {
        try {
            const response = await fetch(`data.json?v=${Date.now()}`);
            allChatData = await response.json();
            renderGroupList();
        } catch (e) { console.error("Data load error", e); }
    }

    function renderGroupList() {
        const list = document.getElementById('group-list');
        list.innerHTML = '';
        Object.keys(allChatData).forEach(name => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.onclick = () => showChat(name);
            item.innerHTML = `
                <span class="text-[17px] text-gray-800 font-medium">${name}</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#b0b0b0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
            `;
            list.appendChild(item);
        });
    }

    function switchView(targetId) {
        document.querySelectorAll('.content-view').forEach(view => view.classList.add('hidden'));
        document.getElementById(targetId).classList.remove('hidden');
        // Aboutç”»é¢ã®æ™‚ã¯ãƒ•ãƒƒã‚¿ãƒ¼ãƒªãƒ³ã‚¯ã‚’éš ã™
        document.getElementById('common-footer').style.display = (targetId === 'about-screen') ? 'none' : 'block';
        window.scrollTo(0, 0);
    }

    function showChat(name) {
        previousView = 'home-screen';
        const container = document.getElementById('chat-content');
        container.innerHTML = '';
        document.getElementById('chat-title').innerText = name;

        (allChatData[name] || []).forEach(msg => {
            const row = document.createElement('div');
            row.className = 'flex items-start space-x-3 mb-4';
            const iconHtml = msg.icon
                ? `<img src="${msg.icon}" class="user-icon">`
                : `<div class="user-icon flex items-center justify-center text-[10px] text-gray-400 bg-gray-100">${msg.color ? '' : 'No Img'}</div>`;
            if (msg.color && !msg.icon) {
                // è‰²æŒ‡å®šãŒã‚ã‚‹å ´åˆã®ã‚¢ã‚¤ã‚³ãƒ³
                row.innerHTML = `<div class="user-icon ${msg.color}"></div>`;
            } else {
                row.innerHTML = iconHtml;
            }
            row.innerHTML += `
                <div class="flex-1">
                    <div class="text-[11px] text-gray-400 mb-1 ml-1">${msg.name} ãƒ» ${msg.date}</div>
                    <div class="bubble text-[15px]">${msg.text}</div>
                </div>
            `;
            container.appendChild(row);
        });
        switchView('chat-screen');
    }

    function showHome() { switchView('home-screen'); }

    function showAbout() {
        // ä»Šã®ç”»é¢ã‚’è¦šãˆã¦ãŠãï¼ˆæˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ãŸã‚ï¼‰
        const currentVisible = Array.from(document.querySelectorAll('.content-view')).find(v => !v.classList.contains('hidden'));
        previousView = currentVisible ? currentVisible.id : 'home-screen';
        switchView('about-screen');
    }

    function goBack() { switchView(previousView); }

    loadData();
</script>
</body>
</html>
